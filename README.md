### Java性能优化

<pre>
性能优化方法论
</pre>

<pre>
1 更少的代码
    1）小程序运行比大程序要快
    2）需要编译的代码越多等待程序启动耗时越长
    3）需要创建的对象越多，垃圾收集量就越大，要分配持有的对象越多，GC周期就越长
    4）从磁盘装载进入JVM的类越多，程序启动话费时间越长
    5）要执行的代码越多，机器硬件缓存的效率就越低，耗时会越长
    随着单个应用程序的功能越来越大，程序的运行效率越来越低，要避免积少成多的效率降低，适时地的拆分应用
2 更优秀的算法
3 数据库的瓶颈
</pre>

<pre>
性能监控重点指数
 1 Cpu使用率
    1）用户态
    2）系统态
 2 磁盘使用率
    大量的IO操作使得磁盘很容易成为瓶颈
    命令 iostat  写入  读取
 3 网络使用率
    nicstat
</pre>

<pre>
调优
选择编译器的类型
   Java编译器的类型选择
      1）client编译器
      2）server编译器
   JIT编译器的版本
   逃逸分析
      逆优化
</pre>

<pre>
垃圾收集器
   1) Serial垃圾收集器
   2) Throughput垃圾收集器
   3) CMS收集器
   5) G1收集器 
</pre>

<pre>
JVM线程调优
</pre>

<pre>
Web容器的性能调优
</pre>

<pre>
数据库调优
</pre>

<pre>
JAVA 大页面支持

          页表是被存储在内存中的，CPU通过总线访问内存，肯定慢于直接访问寄存器的，为了进
      一步优化性能，现代CPU架构引入了TLB，用来缓存一部分经常访问的页表内容。

          TLB是有限的，当超出TLB的存储极限时，就会发生TLB miss，之后，OS就会命令CPU去
      访问内存上的页表。如果频繁的出现TLB miss，程序的性能就会下降的很快。

          为了让TLB可以存储更多的页地址映射关系，我们的做法是调大内存分页大小。

          如果一个页4M，对比一个页4K，前者可以让TLB多存储1000个页地址映射关系，性能的
      提升是比较可观的。

          JVM启用时加参数 -XX:LargePageSizeInBytes=10m

          其实除了JVM可以使用大页面提高性能，还有一种应用更符合内存密集型的场景，那就是
      数据库。数据库的调优中很早就有了这部分的建议
</pre>

<pre>
Java代码优化

      1）尽量在合适的场合使用单例。
      2）尽量避免随意使用静态变量。
      3）及时清除不再需要的会话
      5）使用同步代码块代替同步方法
      6）不要创建一些不使用的方法，不要导入不使用的类。
      7）使用数据库连接池和线程池
      8）使用带缓冲的输入输出流进行IO操作
      9）字符串变量和字符串常量equals的时候将字符串常量写在前面
      10）不要对超出范围的基本数据类型做向下强制转型。
      11）尽量重用对象
      12）尽可能使用局部变量
      13）及时关闭流
      15）尽量使用懒加载的策略，需要的时候才创建对象。
      16）不要在循环中try...catch,应当在循环外。
      17）乘法，除法使用移位命令。
      18）循环内不要不断创建对象引用。
      19）尽量使用HashMap、ArrayList、StringBuilder，除非线程安全需要，否则不推荐使用Hashtable、Vector、StringBuffer，后三
          者由于使用同步机制而导致了性能开销。
      20）把一个基本数据类型转为字符串，基本数据类型.toString()是最快的方式、String.valueOf(数据)次之、数据+""最慢
      21)对于ThreadLocal使用前或者使用后一定要先remove
      22) 以常量定义的方式替代魔鬼数字，魔鬼数字的存在极大的降低了代码可读性。
      23）所有重写的方法必须保留@Override注解
      25）循环体内不要使用“+”字符串拼接，而是要使用StringBuilder不断append。
      26）ArrayList循环使用for循环，LinkedList循环使用foreach循环
</pre>
